<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能文档处理系统 - AI增强版WPS</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 主容器 -->
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <header class="top-navbar">
            <div class="navbar-left">
                <div class="logo">
                    <i class="fas fa-file-alt"></i>
                    <span>智能文档处理系统</span>
                </div>
                <div class="file-menu">
                    <button class="menu-btn" onclick="toggleFileMenu()">
                        <i class="fas fa-bars"></i>
                        文件
                    </button>
                    <div class="dropdown-menu" id="fileMenu">
                        <a href="#" onclick="openFileDialog()"><i class="fas fa-upload"></i> 上传文档</a>
                        <a href="#" onclick="newDocument()"><i class="fas fa-file-plus"></i> 新建文档</a>
                        <a href="#" onclick="openRecentFiles()"><i class="fas fa-history"></i> 最近文件</a>
                        <div class="menu-divider"></div>
                        <a href="#" onclick="showSettings()"><i class="fas fa-cog"></i> 设置</a>
                    </div>
                </div>
            </div>
            
            <div class="navbar-center">
                <div class="document-title">
                    <input type="text" id="documentTitle" placeholder="未命名文档" readonly>
                </div>
            </div>
            
            <div class="navbar-right">
                <button class="icon-btn" onclick="showHelp()" title="帮助">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button class="icon-btn" onclick="showUserMenu()" title="用户菜单">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </header>

        <!-- 工具栏 -->
        <div class="toolbar">
            <div class="toolbar-section">
                <button class="tool-btn primary" onclick="openFileDialog()">
                    <i class="fas fa-upload"></i>
                    上传文档
                </button>
                <button class="tool-btn" onclick="processDocument()" id="processBtn" disabled>
                    <i class="fas fa-magic"></i>
                    AI处理
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button class="tool-btn" onclick="enhanceDocument('general')" id="enhanceBtn" disabled>
                    <i class="fas fa-wand-magic-sparkles"></i>
                    智能优化
                </button>
                <div class="dropdown">
                    <button class="tool-btn dropdown-toggle" onclick="toggleEnhanceMenu()" disabled id="enhanceMenuBtn">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content" id="enhanceMenu">
                        <a href="#" onclick="enhanceDocument('academic')">学术风格</a>
                        <a href="#" onclick="enhanceDocument('business')">商务风格</a>
                        <a href="#" onclick="enhanceDocument('creative')">创意风格</a>
                    </div>
                </div>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <button class="tool-btn" onclick="showExportOptions()" id="exportBtn" disabled>
                    <i class="fas fa-download"></i>
                    导出
                </button>
                <button class="tool-btn" onclick="shareDocument()" id="shareBtn" disabled>
                    <i class="fas fa-share"></i>
                    分享
                </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="toolbar-section">
                <div class="zoom-controls">
                    <button class="tool-btn small" onclick="zoomOut()">
                        <i class="fas fa-minus"></i>
                    </button>
                    <span class="zoom-level" id="zoomLevel">100%</span>
                    <button class="tool-btn small" onclick="zoomIn()">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="main-content">
            <!-- 侧边栏 -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-tabs">
                    <button class="tab-btn active" onclick="switchTab('files')" data-tab="files">
                        <i class="fas fa-folder"></i>
                        文件
                    </button>
                    <button class="tab-btn" onclick="switchTab('outline')" data-tab="outline">
                        <i class="fas fa-list"></i>
                        大纲
                    </button>
                    <button class="tab-btn" onclick="switchTab('ai')" data-tab="ai">
                        <i class="fas fa-robot"></i>
                        AI助手
                    </button>
                </div>

                <!-- 文件管理面板 -->
                <div class="tab-content active" id="files-tab">
                    <div class="panel-header">
                        <h3>文档管理</h3>
                        <button class="icon-btn small" onclick="refreshFileList()">
                            <i class="fas fa-refresh"></i>
                        </button>
                    </div>
                    <div class="file-list" id="fileList">
                        <div class="empty-state">
                            <i class="fas fa-file-upload"></i>
                            <p>还没有文档</p>
                            <button class="upload-btn" onclick="openFileDialog()">上传文档</button>
                        </div>
                    </div>
                </div>

                <!-- 大纲面板 -->
                <div class="tab-content" id="outline-tab">
                    <div class="panel-header">
                        <h3>文档大纲</h3>
                    </div>
                    <div class="outline-content" id="outlineContent">
                        <div class="empty-state">
                            <i class="fas fa-list"></i>
                            <p>暂无文档大纲</p>
                        </div>
                    </div>
                </div>

                <!-- AI助手面板 -->
                <div class="tab-content" id="ai-tab">
                    <div class="panel-header">
                        <h3>AI助手</h3>
                    </div>
                    <div class="ai-assistant" id="aiAssistant">
                        <div class="ai-suggestions" id="aiSuggestions">
                            <div class="empty-state">
                                <i class="fas fa-robot"></i>
                                <p>AI助手就绪</p>
                                <p class="small">上传文档后获取智能建议</p>
                            </div>
                        </div>
                        <div class="ai-input-area">
                            <textarea placeholder="向AI助手提问..." id="aiInput" rows="3"></textarea>
                            <button class="send-btn" onclick="sendAIMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 文档编辑区域 -->
            <main class="document-area">
                <div class="document-container" id="documentContainer">
                    <!-- 欢迎页面 -->
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-content">
                            <div class="welcome-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h1>智能文档处理系统</h1>
                            <p>基于AI技术的新一代文档处理平台</p>
                            
                            <div class="action-cards">
                                <div class="action-card" onclick="openFileDialog()">
                                    <i class="fas fa-upload"></i>
                                    <h3>上传文档</h3>
                                    <p>支持Word、PDF、TXT等格式</p>
                                </div>
                                <div class="action-card" onclick="newDocument()">
                                    <i class="fas fa-file-plus"></i>
                                    <h3>新建文档</h3>
                                    <p>从空白文档开始创作</p>
                                </div>
                                <div class="action-card" onclick="openRecentFiles()">
                                    <i class="fas fa-history"></i>
                                    <h3>最近文件</h3>
                                    <p>继续编辑之前的文档</p>
                                </div>
                            </div>

                            <div class="features-showcase">
                                <h2>核心功能</h2>
                                <div class="features-grid">
                                    <div class="feature-item">
                                        <i class="fas fa-brain"></i>
                                        <h4>AI智能处理</h4>
                                        <p>自动优化文档内容和结构</p>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-image"></i>
                                        <h4>图像智能编辑</h4>
                                        <p>自动分析和优化图片</p>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-file-export"></i>
                                        <h4>多格式导出</h4>
                                        <p>支持Word、PDF、HTML等格式</p>
                                    </div>
                                    <div class="feature-item">
                                        <i class="fas fa-users"></i>
                                        <h4>实时协作</h4>
                                        <p>多人同时编辑和评论</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 文档内容显示区域 -->
                    <div class="document-content" id="documentContent" style="display: none;">
                        <div class="document-header">
                            <div class="document-info">
                                <h2 id="currentDocumentTitle">文档标题</h2>
                                <div class="document-meta">
                                    <span id="documentStatus">已加载</span>
                                    <span>•</span>
                                    <span id="lastModified">刚刚</span>
                                    <span>•</span>
                                    <span id="documentSize">--</span>
                                </div>
                            </div>
                            <div class="document-actions">
                                <button class="action-btn" onclick="editDocument()">
                                    <i class="fas fa-edit"></i>
                                    编辑
                                </button>
                                <button class="action-btn" onclick="previewDocument()">
                                    <i class="fas fa-eye"></i>
                                    预览
                                </button>
                            </div>
                        </div>

                        <div class="document-viewer" id="documentViewer">
                            <!-- 文档内容将在这里动态加载 -->
                        </div>
                    </div>
                </div>
            </main>

            <!-- AI交互面板 -->
            <aside class="ai-interaction-panel" id="aiInteractionPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-robot"></i> AI助手</h3>
                    <div class="panel-actions">
                        <button class="icon-btn small" onclick="openAISettings()" title="设置">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="icon-btn small" onclick="toggleAIPanel()" title="收起">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- AI模型状态 -->
                <div class="ai-status">
                    <div class="model-info">
                        <div class="model-details">
                            <span class="model-name" id="currentModel">GPT-4</span>
                            <span class="model-version">Version 1.0</span>
                        </div>
                        <span class="model-status online" id="modelStatus">
                            <i class="fas fa-circle"></i>
                            在线
                        </span>
                    </div>
                    <div class="usage-info">
                        <div class="usage-item">
                            <span class="usage-label">今日使用:</span>
                            <span class="usage-value" id="tokenCount">1,250 tokens</span>
                        </div>
                        <div class="usage-item">
                            <span class="usage-label">本月剩余:</span>
                            <span class="usage-value" id="monthlyQuota">48,750 tokens</span>
                        </div>
                    </div>
                </div>

                <!-- 快速操作 -->
                <div class="quick-actions">
                    <h4>快速操作</h4>
                    <div class="action-grid">
                        <button class="action-btn" onclick="quickAction('optimize')" title="优化选中内容">
                            <i class="fas fa-magic"></i>
                            <span>智能优化</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('summarize')" title="生成内容摘要">
                            <i class="fas fa-compress-alt"></i>
                            <span>生成摘要</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('translate')" title="翻译内容">
                            <i class="fas fa-language"></i>
                            <span>翻译</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('rewrite')" title="重写内容">
                            <i class="fas fa-pen"></i>
                            <span>重写</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('expand')" title="扩展内容">
                            <i class="fas fa-expand-arrows-alt"></i>
                            <span>扩展</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('format')" title="格式化文档">
                            <i class="fas fa-align-left"></i>
                            <span>格式化</span>
                        </button>
                    </div>
                </div>

                <!-- 选中内容预览 -->
                <div class="selected-content" id="selectedContent" style="display: none;">
                    <div class="selected-header">
                        <span><i class="fas fa-text-height"></i> 选中内容</span>
                        <button class="icon-btn small" onclick="clearSelection()" title="清除选择">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="selected-preview">
                        <div class="selected-text" id="selectedText"></div>
                        <div class="selected-stats">
                            <span id="selectedWordCount">0 字</span> • 
                            <span id="selectedCharCount">0 字符</span>
                        </div>
                    </div>
                </div>

                <!-- AI对话区域 -->
                <div class="ai-chat">
                    <h4>AI对话</h4>
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai-message">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-text">
                                    你好！我是你的AI文档助手。你可以：<br>
                                    • 选择文档中的任意内容进行编辑<br>
                                    • 使用快速操作进行常见处理<br>
                                    • 直接与我对话获取帮助
                                </div>
                                <div class="message-time">刚刚</div>
                                <div class="message-actions">
                                    <button class="action-link" onclick="showHelp()">查看帮助</button>
                                    <button class="action-link" onclick="showExamples()">查看示例</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 输入区域 -->
                    <div class="chat-input">
                        <div class="input-header">
                            <div class="input-mode">
                                <button class="mode-btn active" onclick="switchInputMode('text')" data-mode="text">
                                    <i class="fas fa-keyboard"></i>
                                    文本
                                </button>
                                <button class="mode-btn" onclick="switchInputMode('voice')" data-mode="voice">
                                    <i class="fas fa-microphone"></i>
                                    语音
                                </button>
                            </div>
                        </div>
                        <div class="input-container">
                            <textarea id="chatInput" placeholder="输入指令或问题，例如：'优化这段文字的表达'、'翻译为英文'..." rows="3"></textarea>
                            <div class="input-tools">
                                <button class="tool-btn" onclick="insertTemplate()" title="插入模板">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button class="tool-btn" onclick="attachFile()" title="附加文件">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button class="tool-btn" onclick="toggleVoiceInput()" title="语音输入">
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button class="send-btn" onclick="sendMessage()" title="发送">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 处理进度 -->
                <div class="ai-progress" id="aiProgress" style="display: none;">
                    <div class="progress-header">
                        <div class="progress-info">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span id="progressTitle">AI处理中...</span>
                        </div>
                        <button class="icon-btn small" onclick="cancelAIProcess()" title="取消">
                            <i class="fas fa-stop"></i>
                        </button>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-details">
                        <div class="progress-text" id="progressText">正在分析文档内容...</div>
                        <div class="progress-time" id="progressTime">预计 30 秒</div>
                    </div>
                </div>

                <!-- 建议操作 -->
                <div class="ai-suggestions" id="aiSuggestions" style="display: none;">
                    <h4>建议操作</h4>
                    <div class="suggestions-list" id="suggestionsList">
                        <!-- 动态生成的建议 -->
                    </div>
                </div>
            </aside>
        </div>

        <!-- 状态栏 -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="status-item" id="connectionStatus">
                    <i class="fas fa-circle connected"></i>
                    已连接
                </span>
                <span class="status-item" id="documentCount">0 个文档</span>
            </div>
            <div class="status-center">
                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="progress-text" id="progressText">处理中...</span>
                </div>
            </div>
            <div class="status-right">
                <span class="status-item" id="wordCount">0 字</span>
                <span class="status-item" id="currentTime"></span>
            </div>
        </footer>
    </div>

    <!-- 模态框 -->
    <!-- 上传对话框 -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>上传文档</h3>
                <button class="close-btn" onclick="closeModal('uploadModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>拖拽文件到此处或点击选择</p>
                    <p class="small">支持 Word、PDF、TXT、HTML 格式，最大 50MB</p>
                    <input type="file" id="fileInput" accept=".docx,.pdf,.txt,.html,.doc" style="display: none;">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                        选择文件
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 处理选项对话框 -->
    <div class="modal" id="processModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>AI处理选项</h3>
                <button class="close-btn" onclick="closeModal('processModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="processInstruction">处理指令：</label>
                    <textarea id="processInstruction" rows="4" placeholder="请描述您希望AI如何处理这个文档..."></textarea>
                </div>
                <div class="form-group">
                    <label>处理选项：</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="processText" checked>
                            <span class="checkmark"></span>
                            处理文本内容
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="analyzeImages" checked>
                            <span class="checkmark"></span>
                            分析图像内容
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="optimizeStructure">
                            <span class="checkmark"></span>
                            优化文档结构
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="textStyle">文本风格：</label>
                    <select id="textStyle">
                        <option value="professional">专业</option>
                        <option value="academic">学术</option>
                        <option value="casual">休闲</option>
                        <option value="business">商务</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeModal('processModal')">取消</button>
                <button class="btn primary" onclick="startProcessing()">开始处理</button>
            </div>
        </div>
    </div>

    <!-- 导出选项对话框 -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>导出文档</h3>
                <button class="close-btn" onclick="closeModal('exportModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>导出格式：</label>
                    <div class="format-options">
                        <label class="format-option">
                            <input type="radio" name="exportFormat" value="docx" checked>
                            <div class="format-card">
                                <i class="fas fa-file-word"></i>
                                <span>Word (.docx)</span>
                            </div>
                        </label>
                        <label class="format-option">
                            <input type="radio" name="exportFormat" value="pdf">
                            <div class="format-card">
                                <i class="fas fa-file-pdf"></i>
                                <span>PDF (.pdf)</span>
                            </div>
                        </label>
                        <label class="format-option">
                            <input type="radio" name="exportFormat" value="html">
                            <div class="format-card">
                                <i class="fas fa-file-code"></i>
                                <span>HTML (.html)</span>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="templateType">模板类型：</label>
                    <select id="templateType">
                        <option value="default">默认</option>
                        <option value="professional">专业</option>
                        <option value="modern">现代</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="exportOptions">导出选项：</label>
                    <select id="exportOptions">
                        <option value="standard">标准</option>
                        <option value="minimal">简化</option>
                        <option value="detailed">详细</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeModal('exportModal')">取消</button>
                <button class="btn primary" onclick="startExport()">导出</button>
            </div>
        </div>
    </div>

    <!-- AI设置对话框 -->
    <div class="modal" id="aiSettingsModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> AI助手设置</h3>
                <button class="close-btn" onclick="closeModal('aiSettingsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab active" onclick="switchSettingsTab('model')" data-tab="model">
                        <i class="fas fa-brain"></i>
                        模型设置
                    </button>
                    <button class="settings-tab" onclick="switchSettingsTab('behavior')" data-tab="behavior">
                        <i class="fas fa-sliders-h"></i>
                        行为设置
                    </button>
                    <button class="settings-tab" onclick="switchSettingsTab('advanced')" data-tab="advanced">
                        <i class="fas fa-cogs"></i>
                        高级设置
                    </button>
                </div>

                <!-- 模型设置 -->
                <div class="settings-content active" id="model-settings">
                    <div class="form-group">
                        <label for="aiModel">AI模型：</label>
                        <select id="aiModel" onchange="updateModelSettings()">
                            <option value="gpt-4">GPT-4 (推荐)</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="claude-3">Claude-3</option>
                        </select>
                        <p class="help-text">选择适合的AI模型。GPT-4提供最佳质量但速度较慢。</p>
                    </div>

                    <div class="form-group">
                        <label for="apiKey">API密钥：</label>
                        <div class="input-with-button">
                            <input type="password" id="apiKey" placeholder="输入您的API密钥">
                            <button class="btn secondary" onclick="testAPIKey()">测试连接</button>
                        </div>
                        <p class="help-text">请确保API密钥有足够的使用额度。</p>
                    </div>

                    <div class="form-group">
                        <label for="maxTokens">最大Token数：</label>
                        <div class="slider-container">
                            <input type="range" id="maxTokens" min="100" max="8000" value="4000" 
                                   oninput="updateTokenDisplay(this.value)">
                            <div class="slider-labels">
                                <span>100</span>
                                <span id="tokenDisplay">4000</span>
                                <span>8000</span>
                            </div>
                        </div>
                        <p class="help-text">控制AI响应的最大长度。较高的值允许更详细的回答。</p>
                    </div>

                    <div class="form-group">
                        <label for="temperature">创造性水平：</label>
                        <div class="slider-container">
                            <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" 
                                   oninput="updateTemperatureDisplay(this.value)">
                            <div class="slider-labels">
                                <span>保守</span>
                                <span id="temperatureDisplay">平衡</span>
                                <span>创造</span>
                            </div>
                        </div>
                        <p class="help-text">控制AI回答的创造性。较低的值更保守准确，较高的值更有创意。</p>
                    </div>
                </div>

                <!-- 行为设置 -->
                <div class="settings-content" id="behavior-settings">
                    <div class="form-group">
                        <label for="responseStyle">回答风格：</label>
                        <select id="responseStyle">
                            <option value="professional">专业</option>
                            <option value="friendly">友好</option>
                            <option value="concise">简洁</option>
                            <option value="detailed">详细</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="language">默认语言：</label>
                        <select id="language">
                            <option value="zh-CN">中文</option>
                            <option value="en-US">English</option>
                            <option value="ja-JP">日本語</option>
                            <option value="ko-KR">한국어</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>自动功能：</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoSuggest" checked>
                                <span class="checkmark"></span>
                                自动提供建议
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoOptimize">
                                <span class="checkmark"></span>
                                自动优化文本
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoTranslate">
                                <span class="checkmark"></span>
                                检测并提示翻译
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="contextAware" checked>
                                <span class="checkmark"></span>
                                上下文感知
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="responseTime">响应延迟：</label>
                        <select id="responseTime">
                            <option value="immediate">立即响应</option>
                            <option value="short">短暂延迟(1秒)</option>
                            <option value="normal" selected>正常延迟(2秒)</option>
                            <option value="long">较长延迟(5秒)</option>
                        </select>
                        <p class="help-text">设置AI响应的延迟时间，避免频繁调用。</p>
                    </div>
                </div>

                <!-- 高级设置 -->
                <div class="settings-content" id="advanced-settings">
                    <div class="form-group">
                        <label for="systemPrompt">系统提示词：</label>
                        <textarea id="systemPrompt" rows="4" placeholder="自定义AI的行为和角色...">
你是一个专业的文档编辑助手，专注于帮助用户改进文档内容。请保持专业、准确和有帮助的态度。
                        </textarea>
                        <p class="help-text">自定义AI的行为模式和回答风格。</p>
                    </div>

                    <div class="form-group">
                        <label for="contextLength">上下文长度：</label>
                        <select id="contextLength">
                            <option value="short">短(1000字符)</option>
                            <option value="medium" selected>中(3000字符)</option>
                            <option value="long">长(6000字符)</option>
                            <option value="full">完整文档</option>
                        </select>
                        <p class="help-text">AI分析文档时考虑的上下文范围。</p>
                    </div>

                    <div class="form-group">
                        <label>调试选项：</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="showTokenUsage">
                                <span class="checkmark"></span>
                                显示Token使用量
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="showProcessTime">
                                <span class="checkmark"></span>
                                显示处理时间
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="logAPIErrors">
                                <span class="checkmark"></span>
                                记录API错误
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customEndpoint">自定义API端点：</label>
                        <input type="text" id="customEndpoint" placeholder="https://api.openai.com/v1/chat/completions">
                        <p class="help-text">使用自定义的API端点（高级用户）。</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="resetSettings()">重置</button>
                <button class="btn secondary" onclick="exportSettings()">导出配置</button>
                <button class="btn secondary" onclick="importSettings()">导入配置</button>
                <button class="btn primary" onclick="saveAISettings()">保存设置</button>
            </div>
        </div>
    </div>

    <!-- 模板选择对话框 -->
    <div class="modal" id="templateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-list"></i> 选择指令模板</h3>
                <button class="close-btn" onclick="closeModal('templateModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="template-categories">
                    <div class="category">
                        <h4>文本优化</h4>
                        <div class="template-list">
                            <button class="template-item" onclick="insertInstructionTemplate('optimize_clarity')">
                                <i class="fas fa-eye"></i>
                                <div>
                                    <span class="template-name">提升清晰度</span>
                                    <span class="template-desc">让文字更清晰易懂</span>
                                </div>
                            </button>
                            <button class="template-item" onclick="insertInstructionTemplate('optimize_tone')">
                                <i class="fas fa-volume-up"></i>
                                <div>
                                    <span class="template-name">调整语调</span>
                                    <span class="template-desc">改变文本的语调风格</span>
                                </div>
                            </button>
                            <button class="template-item" onclick="insertInstructionTemplate('fix_grammar')">
                                <i class="fas fa-spell-check"></i>
                                <div>
                                    <span class="template-name">语法修正</span>
                                    <span class="template-desc">修正语法和拼写错误</span>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <div class="category">
                        <h4>内容处理</h4>
                        <div class="template-list">
                            <button class="template-item" onclick="insertInstructionTemplate('summarize')">
                                <i class="fas fa-compress-alt"></i>
                                <div>
                                    <span class="template-name">生成摘要</span>
                                    <span class="template-desc">提取关键信息</span>
                                </div>
                            </button>
                            <button class="template-item" onclick="insertInstructionTemplate('expand')">
                                <i class="fas fa-expand-arrows-alt"></i>
                                <div>
                                    <span class="template-name">扩展内容</span>
                                    <span class="template-desc">丰富和详细化内容</span>
                                </div>
                            </button>
                            <button class="template-item" onclick="insertInstructionTemplate('restructure')">
                                <i class="fas fa-sitemap"></i>
                                <div>
                                    <span class="template-name">重构结构</span>
                                    <span class="template-desc">改善文档组织结构</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="category">
                        <h4>翻译和本地化</h4>
                        <div class="template-list">
                            <button class="template-item" onclick="insertInstructionTemplate('translate_en')">
                                <i class="fas fa-language"></i>
                                <div>
                                    <span class="template-name">翻译为英文</span>
                                    <span class="template-desc">保持原意的英文翻译</span>
                                </div>
                            </button>
                            <button class="template-item" onclick="insertInstructionTemplate('localize')">
                                <i class="fas fa-globe"></i>
                                <div>
                                    <span class="template-name">本地化</span>
                                    <span class="template-desc">适应目标地区文化</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知容器 -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="hiddenFileInput" accept=".docx,.pdf,.txt,.html,.doc" style="display: none;">

    <!-- JavaScript -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/document-handler.js"></script>
</body>
</html>